"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Checkers(){function e(e,t){var n=this;this.x=e,this.y=t,this.id="cell_"+e+"_"+t,this.color=COLORS.cell[e%2===t%2],this.checker=null,this.cellDOM=function(){var e=document.createElement("div");return e.id=n.id,e.className="cell cell__"+n.color,e.style.width=WH+"%",e.style.height=WH+"%",e.addEventListener("click",c),e.hasOwnProperty("obj")||(e.obj=n),e}(),this.getPosition=function(){return{x:n.x,y:n.y}},this.containChecker=function(e){return n.checker=e},this.hasChecker=function(){return null!=n.checker},this.removeChecker=function(){n.cellDOM.removeChild(n.checker.checkerDOM),n.checker=null},this.highlight=function(){return n.cellDOM.classList.toggle("highlight")},this.unhighlight=function(){return n.cellDOM.classList.remove("highlight")},this.isHighlighted=function(){return n.cellDOM.classList.contains("highlight")}}function t(e){var t=this;this.color=e,this.cell=null,this.checkerDOM=function(){var e=document.createElement("div");return e.className="checker checker__"+t.color,e.hasOwnProperty("obj")||(e.obj=t),e.addEventListener("click",r),e}(),this.activate=function(){return t.checkerDOM.classList.toggle("active")},this.belongsTo=function(e){t.cell=e,e&&e.cellDOM.appendChild(t.checkerDOM)},this.canTurn=function(e){return t.color===e},this.isMovePossible=function(e,n){return t.canTurn(n)&&(null==e||e!==t)},this.moveTo=function(e){var n=f.eatIfItPossible(t.cell,e);return t.cell.removeChecker(),t.belongsTo(e),e.containChecker(t),n}}function n(){var e=document.getElementsByClassName("checker active");if(e.length){Object.keys(e).map(function(t){return e[t].classList.remove("active")});var t=document.querySelectorAll(".cell.highlight");Object.keys(t).map(function(e){return t[e].obj.unhighlight()})}}function r(e){var t=this.obj;if(n(),void 0!==t&&t.isMovePossible(a.currentChecker,a.currentTurn)){var r=f.getAvailableMoves(t);t.activate(),f.showMoves(r),a.currentChecker=t}else a.currentChecker=null;return!1}function c(e){var t=this.obj;if(a.currentChecker&&t.isHighlighted()){var r=a.currentChecker.moveTo(t),c=f.getAvailableMoves(a.currentChecker,!0);n(),r&&c?(a.currentChecker.activate(),f.showMoves(c)):f.setNexnTurn(),o()}return!1}function l(){for(var t=1;t<=a.N;t++)for(var n=1;n<=a.N;n++){var r=new e(t,n);a.boardDOM.appendChild(r.cellDOM),i(r)}}function i(e){if(e.y%2===e.x%2&&(e.x<TOP_UP||e.x>BOTTOM_FROM)){var n=e.x<TOP_UP?COLORS.checker.dark:COLORS.checker.light,r=new t(n);r.belongsTo(e),e.containChecker(r)}}function o(){a.turnsCountDOM.textContent=a.turnsCount,a.turnColorDOM.style.backgroundColor=BG_COLORS[a.currentTurn]}function h(e,n){n.forEach(function(n){var r=new t(e),c=document.getElementById("cell_"+n.x+"_"+n.y).obj;r.belongsTo(c),c.containChecker(r)})}function u(e,t){var n=document.getElementById("cell_"+e+"_"+t).obj;return!(!n||!n.checker)&&(n.removeChecker(),!0)}var s,a=this;this.N=N,this.TURNS=[COLORS.checker.light,COLORS.checker.dark],this.CELL_AFTER_EATING="cell_after_eating",this.CELL_FREE="cell_free",this.currentTurn=this.TURNS[0],this.turnsCount=0,this.currentChecker=null,this.boardDOM=document.getElementById("board"),this.turnsCountDOM=document.getElementById("turns_count"),this.turnColorDOM=document.getElementById("current_turn_color"),this.getCell=function(e,t){var n=document.getElementById("cell_"+e+"_"+t);return n?n.obj:null};var f={LEFT:0,RIGHT:1,moves:(s={},_defineProperty(s,COLORS.checker.light,{fw:[{x:-1,y:-1},{x:-1,y:1}],bw:[{x:1,y:-1},{x:1,y:1}]}),_defineProperty(s,COLORS.checker.dark,{fw:[{x:1,y:-1},{x:1,y:1}],bw:[{x:-1,y:-1},{x:-1,y:1}]}),s),showMoves:function(e){e&&e.forEach(function(e){e&&e.cell&&e.cell.highlight()})},getAvailableMoves:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.moves[e.color],r=function(e){return e&&e.cell&&e.type===a.CELL_AFTER_EATING},c=function(e){return e&&e.cell&&e.type===a.CELL_FREE},l=[];return l.push(this.getAvailableCell(e,n.fw[this.LEFT],t),this.getAvailableCell(e,n.fw[this.RIGHT],t),this.getAvailableCell(e,n.bw[this.LEFT],!0),this.getAvailableCell(e,n.bw[this.RIGHT],!0)),l=l.some(r)?l.filter(r):l.filter(c),l.length?l:null},getAvailableCell:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.cell.getPosition(),c=a.getCell(r.x+t.x,r.y+t.y),l=c&&c.hasChecker();return l||n?l&&e.color!==c.checker.color?{type:a.CELL_AFTER_EATING,cell:this.cellAfterEating(c.getPosition(),t)}:null:{type:a.CELL_FREE,cell:c}},cellAfterEating:function(e,t){var n=a.getCell(e.x+t.x,e.y+t.y);return n&&!n.hasChecker()?n:null},eatIfItPossible:function(e,t){if(2===Math.abs(e.x-t.x)){var n=this.calcDirectionOfMove(e,t),r=a.getCell(e.x+n.x,e.y+n.y);return r.checker.belongsTo(null),r.removeChecker(),!0}return!1},calcDirectionOfMove:function(e,t){return{x:(t.x-e.x)/2,y:(t.y-e.y)/2}},haveSomeoneToEat:function(){},setNexnTurn:function(){a.turnsCount++,a.currentTurn=a.TURNS[a.turnsCount%2]}};l(),o(),h(COLORS.checker.dark,[{x:5,y:5},{x:5,y:3}]),u(6,4),u(6,6)}var N=8,WH=100/N,TOP_UP=4,BOTTOM_FROM=N-3,BG_COLORS={red:"#ff0000",blue:"#0000ff"},COLORS={checker:{light:"red",dark:"blue"},cell:{true:"black",false:"white"}};Checkers.init=function(){window.checkers=new Checkers},Checkers.init();